<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_alumno_partes_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="alumno">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            .header { background-color: #2c3e50; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
                            .table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            .table th { background-color: #34495e; color: white; padding: 10px; text-align: left; }
                            .table td { padding: 10px; border: 1px solid #ddd; }
                            .section { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #3498db; }
                        </style>

                        <div class="header">
                            <h2 style="margin: 0;">Informe de Partes - Alumno: <t t-esc="alumno.name"/> <t t-esc="alumno.apellidos"/></h2>
                            <p>NIA: <t t-esc="alumno.nia"/> | Grupo: <t t-esc="alumno.grupo_id.name"/></p>
                        </div>

                        <div class="section">
                            <h3>Partes Registrados</h3>
                            <table class="table">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Hora</th>
                                        <th>Motivo</th>
                                        <th>Profesor</th>
                                        <th>Estado</th>
                                        <th>Lugar</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="alumno.parte_ids" t-as="parte">
                                        <tr>
                                            <td><t t-esc="parte.fecha"/></td>
                                            <td><span t-field="parte.hora" widget="float_time"/></td>
                                            <td><t t-esc="parte.motivo_id.name"/></td>
                                            <td><t t-esc="parte.profesor_id.name"/></td>
                                            <td><t t-esc="parte.state"/></td>
                                            <td><t t-esc="parte.lugar_id.name"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>

                        <div class="section">
                            <h3>Resumen</h3>
                            <p>Total de Partes: <t t-esc="len(alumno.parte_ids)"/></p>
                            <p>Partes Pendientes: <t t-esc="len([p for p in alumno.parte_ids if p.state == 'pendiente'])"/></p>
                            <p>Partes Cerrados: <t t-esc="len([p for p in alumno.parte_ids if p.state == 'cerrado'])"/></p>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <record id="action_report_alumno_partes" model="ir.actions.report">
        <field name="name">Informe Partes Alumno</field>
        <field name="model">instituto.alumno</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">partes_escolares.report_alumno_partes_document</field>
        <field name="report_file">partes_escolares.report_alumno_partes_document</field>
        <field name="print_report_name">'Partes de %(object.name)s'</field>
        <field name="binding_model_id" ref="model_instituto_alumno"/>
        <field name="binding_type">report</field>
    </record>

</odoo>