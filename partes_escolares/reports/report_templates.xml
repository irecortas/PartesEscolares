<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <template id="report_parte_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            .parte-header { background-color: #2c3e50; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
                            .parte-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            .parte-table th { background-color: #34495e; color: white; padding: 10px; text-align: left; width: 30%; }
                            .parte-table td { padding: 10px; border: 1px solid #ddd; }
                            .parte-section { margin-top: 20px; padding: 15px; background-color: #f8f9fa; border-left: 4px solid #3498db; }
                            .antecedentes-title { color: #e74c3c; margin-top: 20px; font-weight: bold; border-bottom: 1px solid #e74c3c; }
                        </style>
                        
                        <div class="parte-header">
                            <h2 style="margin: 0;">Parte de Disciplina - <t t-esc="o.name"/></h2>
                        </div>
                        
                        <table class="parte-table">
                            <tr><th>Fecha</th><td><t t-esc="o.fecha"/></td></tr>
                            <tr><th>Alumno</th><td><t t-esc="o.alumno_id.name"/> <t t-esc="o.alumno_id.apellidos"/></td></tr>
                            <tr><th>Grupo</th><td><t t-esc="o.grupo_id.name"/></td></tr>
                            <tr><th>Profesor</th><td><t t-esc="o.profesor_id.name"/></td></tr>
                            <tr><th>Motivo</th><td><t t-esc="o.motivo_id.name"/></td></tr>
                        </table>
                        
                        <div class="parte-section">
                            <h4>Descripción Detallada</h4>
                            <div><t t-raw="o.descripcion or 'Sin descripción'"/></div>
                        </div>

                        <div class="mt-4">
                            <h4 class="antecedentes-title">Antecedentes del Alumno</h4>
                            <t t-set="otros_partes" t-value="env['instituto.parte'].search([('alumno_id', '=', o.alumno_id.id), ('id', '!=', o.id)])"/>
                            <table class="table table-sm mt-2">
                                <thead>
                                    <tr>
                                        <th>Fecha</th>
                                        <th>Motivo</th>
                                        <th>Estado</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <t t-foreach="otros_partes" t-as="hist">
                                        <tr>
                                            <td><span t-field="hist.fecha"/></td>
                                            <td><span t-field="hist.motivo_id.name"/></td>
                                            <td><span t-field="hist.state"/></td>
                                        </tr>
                                    </t>
                                    <tr t-if="not otros_partes">
                                        <td colspan="3" class="text-muted">No existen antecedentes previos.</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <template id="report_alumno_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            .alumno-header { background-color: #e74c3c; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
                            .alumno-table { width: 100%; border-collapse: collapse; }
                            .alumno-table th { background-color: #c0392b; color: white; padding: 10px; text-align: left; width: 30%; }
                            .alumno-table td { padding: 10px; border: 1px solid #ddd; }
                        </style>
                        
                        <div class="alumno-header">
                            <h2 style="margin: 0;">Ficha Alumno - <t t-esc="o.name"/> <t t-esc="o.apellidos"/></h2>
                        </div>
                        
                        <table class="alumno-table">
                            <tr><th>Nombre</th><td><t t-esc="o.name"/></td></tr>
                            <tr><th>Apellidos</th><td><t t-esc="o.apellidos"/></td></tr>
                            <tr><th>Matrícula</th><td><t t-esc="o.matricula"/></td></tr>
                            <tr><th>Grupo</th><td><t t-esc="o.grupo_id.name"/></td></tr>
                        </table>

                        <h4 class="mt-4">Resumen de Incidencias</h4>
                        <t t-set="partes_alumno" t-value="env['instituto.parte'].search([('alumno_id', '=', o.id)])"/>
                        <table class="table table-striped mt-2">
                            <thead>
                                <tr>
                                    <th>Fecha</th>
                                    <th>Motivo</th>
                                    <th>Estado</th>
                                </tr>
                            </thead>
                            <tbody>
                                <t t-foreach="partes_alumno" t-as="pa">
                                    <tr>
                                        <td><t t-esc="pa.fecha"/></td>
                                        <td><t t-esc="pa.motivo_id.name"/></td>
                                        <td><t t-esc="pa.state"/></td>
                                    </tr>
                                </t>
                            </tbody>
                        </table>
                        <div class="text-right" style="border-top: 2px solid #c0392b; font-weight: bold; font-size: 1.1em;">
                            Total de Partes: <t t-esc="len(partes_alumno)"/>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    <report id="action_report_parte" model="instituto.parte" string="Parte PDF"
        report_type="qweb-pdf" name="partes_escolares.report_parte_document"
        file="partes_escolares.report_parte_document"/>

    <report id="action_report_alumno" model="instituto.alumno" string="Alumno PDF"
        report_type="qweb-pdf" name="partes_escolares.report_alumno_document"
        file="partes_escolares.report_alumno_document"/>

    <report id="action_report_profesor" model="instituto.profesor" string="Profesor PDF"
        report_type="qweb-pdf" name="partes_escolares.report_profesor_document"
        file="partes_escolares.report_profesor_document"/>

    <report id="action_report_grupo" model="instituto.grupo" string="Grupo PDF"
        report_type="qweb-pdf" name="partes_escolares.report_grupo_document"
        file="partes_escolares.report_grupo_document"/>

    <report id="action_report_motivo" model="instituto.motivo" string="Motivo PDF"
        report_type="qweb-pdf" name="partes_escolares.report_motivo_document"
        file="partes_escolares.report_motivo_document"/>

    <template id="report_profesor_document">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                <t t-call="web.external_layout">
                    <div class="page">
                        <style>
                            .profesor-header { background-color: #16a085; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
                            .info-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
                            .info-table th { background-color: #1abc9c; color: white; padding: 10px; text-align: left; width: 30%; }
                            .info-table td { padding: 10px; border: 1px solid #ddd; }
                            .partes-table { width: 100%; border-collapse: collapse; }
                            .partes-table thead th { background-color: #95a5a6; color: white; padding: 8px; }
                        </style>
                        <div class="profesor-header"><h2>Ficha Profesor - <t t-esc="o.name"/></h2></div>
                        <table class="info-table">
                            <tr><th>Especialidad</th><td><t t-esc="o.especialidad"/></td></tr>
                            <tr><th>Email</th><td><t t-esc="o.email"/></td></tr>
                        </table>
                        <div class="partes-section">
                            <h4>Partes Registrados (<t t-esc="len(o.parte_ids)"/>)</h4>
                            <table class="partes-table table">
                                <thead><tr><th>Fecha</th><th>Alumno</th><th>Motivo</th></tr></thead>
                                <tbody>
                                    <t t-foreach="o.parte_ids" t-as="parte">
                                        <tr>
                                            <td><t t-esc="parte.fecha"/></td>
                                            <td><t t-esc="parte.alumno_id.name"/></td>
                                            <td><t t-esc="parte.motivo_id.name"/></td>
                                        </tr>
                                    </t>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </t>
            </t>
        </t>
    </template>

    </odoo>